var F=Object.defineProperty,ee=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var T=(d,e,t)=>e in d?F(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t,a=(d,e)=>{for(var t in e||(e={}))G.call(e,t)&&T(d,t,e[t]);if(j)for(var t of j(e))H.call(e,t)&&T(d,t,e[t]);return d},k=(d,e)=>ee(d,te(e));var X=(d,e)=>{var t={};for(var i in d)G.call(d,i)&&e.indexOf(i)<0&&(t[i]=d[i]);if(d!=null&&j)for(var i of j(d))e.indexOf(i)<0&&H.call(d,i)&&(t[i]=d[i]);return t};var c=(d,e,t)=>(T(d,typeof e!="symbol"?e+"":e,t),t);class $ extends Error{constructor({kind:e,id:t}){super(`flow-view ${e} not found id=${t}`)}}export{$ as FlowViewErrorItemNotFound};const w=d=>`${d}--highlighted`,R=d=>({transition:`${d} 117ms ease-in-out`}),W=d=>`--fv-default-${d}`,C=d=>`var(--fv-${d},var(${W(d)}))`,l={backgroundColor:C("background-color"),borderRadius:C("border-radius"),boxShadow:C("box-shadow"),connectionColor:C("connection-color"),connectionColorHighlighted:C(w("connection-color")),fontFamily:C("font-family"),fontSize:C("font-size"),nodeBackgroundColor:C("node-background-color"),nodeBorderColorHighlighted:C(w("node-border-color")),textColor:C("text-color")},Y={"border-radius":"2px","font-family":"sans-serif","font-size":"16px"},V={light:k(a({},Y),{"background-color":"#fefefe","connection-color":"#ccc","box-shadow":"0px 0px 7px 1px rgba(0,0,0,0.1)",[w("connection-color")]:"#717171","node-background-color":"#fefefe",[w("node-border-color")]:"#717171","text-color":"#111"}),dark:k(a({},Y),{"background-color":"#555","connection-color":"#aaa","box-shadow":"0px 0px 7px 1px rgba(117,117,117,0.7)",[w("connection-color")]:"#ddd","node-background-color":"#212121",[w("node-border-color")]:"#efefef","text-color":"#bbb"})},M=d=>Object.entries(V[d]).reduce((e,[t,i])=>k(a({},e),{[W(t)]:i}),{});export{w as cssModifierHighlighted};export{R as cssTransition};export{l as cssVar};export{V as cssDefault};export{M as cssTheme};class L{static generateId(e){const t=Math.random().toString(36).replace(/[^a-z]+/g,"").substring(0,5);return e.shadowRoot.getElementById(t)?L.generateId(e):t}constructor(o){var n=o,{cssClassName:e,id:t,view:i}=n,s=X(n,["cssClassName","id","view"]);const r=t||L.generateId(i),h=this.element=document.createElement("div");h.setAttribute("id",r),h.classList.add(e),i.shadowRoot.appendChild(h),this.view=i,this._selected=!1,this.cssClassName=e,this.init(s)}init(){}dispose(){}get bounds(){return this.element.getBoundingClientRect()}get id(){return this.element.getAttribute("id")}set ghost(e){this.element.style.opacity=e?.17:""}set highlight(e){const t=w(this.cssClassName);e?this.element.classList.add(t):this.element.classList.remove(t)}get isSelected(){return this._selected}set selected(e){this._selected=!!e}createElement(e,t){const i=document.createElement(e);return t&&i.classList.add(t),this.element.appendChild(i),i}createSvg(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}remove(){this.dispose(),this.element.remove()}toObject(){return{id:this.id}}}export{L as FlowViewBase};const N=class extends L{init({name:e,node:t}){this.name=e,this.node=t,this.info=this.createElement("div","info"),this.text=e||"",this._onPointerdown=this.onPointerdown.bind(this),this.element.addEventListener("pointerdown",this._onPointerdown),this._onPointerenter=this.onPointerenter.bind(this),this.element.addEventListener("pointerenter",this._onPointerenter),this._onPointerleave=this.onPointerleave.bind(this),this.element.addEventListener("pointerleave",this._onPointerleave),this._onPointerup=this.onPointerup.bind(this),this.element.addEventListener("pointerup",this._onPointerup)}get offsetX(){return this.bounds.x-this.node.bounds.x}set text(e){this.info.innerHTML=e}get halfPinSize(){return Math.round(N.size/2)}dispose(){this.element.removeEventListener("pointerdown",this._onPointerdown),this.element.removeEventListener("pointerenter",this._onPointerenter),this.element.removeEventListener("pointerleave",this._onPointerleave),this.element.removeEventListener("pointerup",this._onPointerup)}onPointerenter(e){e.stopPropagation(),!this.view.isDraggingEdge&&(this.node.isSelected||(this.highlight=!0))}onPointerleave(e){e.stopPropagation(),!this.node.isSelected&&(this.highlight=!1)}toObject(){const e={};return this.name||(e.name=this.name),a(a({},super.toObject()),e)}};let g=N;c(g,"cssClassName","fv-pin"),c(g,"size",10),c(g,"style",{[`.${N.cssClassName}`]:a({"background-color":l.connectionColor,cursor:"none",position:"relative",display:"block",width:`${N.size}px`,height:`${N.size}px`},R("background-color")),[`.${N.cssClassName} .info`]:{visibility:"hidden",position:"absolute","font-family":"monospace","user-select":"none"},[`.${N.cssClassName}:hover .info`]:{visibility:"visible"},[`.${w(N.cssClassName)}`]:{"background-color":l.connectionColorHighlighted}});export{g as FlowViewPin};class I extends g{constructor(e){super(e),this.info.style.top="-25px"}get center(){return{x:this.node.position.x+this.halfPinSize+this.node.borderWidth+this.offsetX,y:this.node.position.y+this.halfPinSize-this.node.borderWidth}}onPointerdown(e){e.stopPropagation()}onPointerup(){if(this.view.isDraggingEdge&&this.view.semiEdge.hasSourcePin){const{source:e}=this.view.semiEdge;this.view.newEdge({source:e,target:this})}}toObject(){return a({},super.toObject())}}class B extends g{constructor(e){super(e),this.info.style.top="15px"}get center(){return{x:this.node.position.x+this.halfPinSize+this.node.borderWidth+this.offsetX,y:this.node.position.y+this.node.bounds.height-this.halfPinSize-this.node.borderWidth}}onPointerdown(e){e.isBubblingFromPin=!0,this.view.createSemiEdge({source:this})}onPointerup(e){e.stopPropagation()}toObject(){return a({},super.toObject())}}const z=class extends L{get hasSourcePin(){return this.source instanceof B}get hasTargetPin(){return this.target instanceof I}get isSemiEdge(){return!this.hasTargetPin||!this.hasSourcePin}init({source:e,target:t}){const i=e instanceof B,s=t instanceof I;this.source=s&&!i?{center:{x:t.center.x,y:t.center.y}}:e,this.target=i&&!s?{center:{x:e.center.x,y:e.center.y}}:t;const o=this.svg=this.createSvg("svg");this.element.appendChild(o);const n=this.line=this.createSvg("line");o.appendChild(n),this.updateGeometry(),this._onPointerdownLine=this.onPointerdownLine.bind(this),n.addEventListener("pointerdown",this._onPointerdownLine),this._onPointerenterLine=this.onPointerenterLine.bind(this),n.addEventListener("pointerenter",this._onPointerenterLine),this._onPointerleaveLine=this.onPointerleaveLine.bind(this),n.addEventListener("pointerleave",this._onPointerleaveLine)}dispose(){this.line.removeEventListener("pointerdown",this._onPointerdownLine),this.line.removeEventListener("pointerenter",this._onPointerenterLine),this.line.removeEventListener("pointerleave",this._onPointerleaveLine)}onPointerdownLine(e){e.stopPropagation(),e.shiftKey||this.view.clearSelection(),this.view.selectEdge(this)}onPointerenterLine(){this.isSemiEdge||this.view.isDraggingEdge||this.isSelected||(this.highlight=!0,this.source.highlight=!0,this.target.highlight=!0)}onPointerleaveLine(){this.isSemiEdge||this.isSelected||(this.highlight=!1,this.source.node.isSelected||(this.source.highlight=!1),this.target.node.isSelected||(this.target.highlight=!1))}updateGeometry(){const{element:e,line:t,svg:i,source:{center:{x:s,y:o}},target:{center:{x:n,y:r}},view:{origin:{x:h,y:v}}}=this,{size:u}=g,f=u/2,m=n<s,_=r<o,A=(_?r-f:o-f)-v,U=(m?n-f:s-f)-h;e.style.top=`${A}px`,e.style.left=`${U}px`;const D=m?s-n+u:n-s+u;e.style.width=`${D}px`,i.setAttribute("width",D);const O=_?o-r+u:r-o+u;e.style.height=`${O}px`,i.setAttribute("height",O);const q=m?D-f:f,J=_?O-f:f,Q=m?f:D-f,Z=_?f:O-f;t.setAttribute("x2",Q),t.setAttribute("y2",Z),t.setAttribute("x1",q),t.setAttribute("y1",J)}toObject(){if(!this.isSemiEdge)return k(a({},super.toObject()),{from:[this.source.node.id,this.source.id],to:[this.target.node.id,this.target.id]})}};let x=z;c(x,"cssClassName","fv-edge"),c(x,"lineWidth",2),c(x,"zIndex",0),c(x,"style",{[`.${z.cssClassName}`]:{display:"flex",position:"absolute",border:0,"pointer-events":"none"},[`.${z.cssClassName} line`]:a({"pointer-events":"all",stroke:l.connectionColor,"stroke-width":z.lineWidth},R("stroke")),[`.${w(z.cssClassName)} line`]:{stroke:l.connectionColorHighlighted}});export{x as FlowViewEdge};const E=class extends L{_createContent({label:e}){const t=this.createElement("div","label");t.textContent=e,this.labelDiv=t,this.label=e}init(e){const{type:t,inputs:i=[],outputs:s=[],x:o,y:n}=e;t&&(this.type=t);const{element:r}=this;this.borderWidth=E.borderWidth,this._inputs=new Map,this.inputListDiv=this.createElement("div","pins");for(const h of i)this.newInput(h);this._createContent(e),this._outputs=new Map,this.outputListDiv=this.createElement("div","pins");for(const h of s)this.newOutput(h);this.position={x:o,y:n},this._onDblclick=this.onDblclick.bind(this),r.addEventListener("dblclick",this._onDblclick),this._onPointerdown=this.onPointerdown.bind(this),r.addEventListener("pointerdown",this._onPointerdown)}dispose(){const{element:e}=this;e.removeEventListener("dblclick",this._onDblclick),e.removeEventListener("pointerdown",this._onPointerdown)}get inputs(){return Array.from(this._inputs.values())}get outputs(){return Array.from(this._outputs.values())}get position(){return{x:this.x,y:this.y}}set position({x:e=0,y:t=0}={}){const{element:i,view:s}=this;this.x=e,this.y=t,i.style.top=`${t-s.origin.y}px`,i.style.left=`${e-s.origin.x}px`}deleteInput(e){this._inputs.get(e).remove(),this._inputs.delete(e)}deleteOutput(e){this._outputs.get(e).remove(),this._outputs.delete(e)}input(e){if(!this._inputs.has(e))throw new $({kind:"input",id:e});return this._inputs.get(e)}output(e){if(!this._outputs.has(e))throw new $({kind:"output",id:e});return this._outputs.get(e)}newInput({id:e,name:t}){const i=new I({id:e,name:t,node:this,view:this.view,cssClassName:g.cssClassName});this._inputs.set(i.id,i),this.inputListDiv.appendChild(i.element)}newOutput({id:e,name:t}){const i=new B({id:e,name:t,node:this,view:this.view,cssClassName:g.cssClassName});this._outputs.set(i.id,i),this.outputListDiv.appendChild(i.element)}onDblclick(e){e.stopPropagation()}onPointerdown(e){if(e.isBubblingFromPin)return;e.isBubblingFromNode=!0,e.shiftKey||this.view.hasSelectedNodes&&this.isSelected||this.view.clearSelection(),this.view.selectNode(this)}toObject(){const{label:e,type:t,inputs:i,outputs:s,x:o,y:n}=this;return k(a(a(a(a(a({},super.toObject()),t?{type:t}:{}),e?{label:e}:{}),i.length>0?{inputs:i.map(r=>r.toObject())}:{}),s.length>0?{outputs:s.map(r=>r.toObject())}:{}),{x:o,y:n})}};let y=E;c(y,"cssClassName","fv-node"),c(y,"borderWidth",1),c(y,"minSize",g.size*4),c(y,"zIndex",x.zIndex+1),c(y,"style",{[`.${E.cssClassName}`]:a({position:"absolute","background-color":l.nodeBackgroundColor,"border-radius":l.borderRadius,"box-shadow":l.boxShadow,display:"flex","flex-direction":"column","justify-content":"space-between",border:`${E.borderWidth}px solid transparent`,"min-height":`${E.minSize}px`,"min-width":`${E.minSize}px`,width:"fit-content","z-index":E.zIndex},R("border-color")),[`.${w(E.cssClassName)}`]:{"border-color":l.nodeBorderColorHighlighted},[`.${E.cssClassName} .label`]:{"user-select":"none","padding-left":"0.5em","padding-right":"0.5em","text-align":"center"},[`.${E.cssClassName} .pins`]:{display:"flex","flex-direction":"row",gap:`${g.size}px`,"justify-content":"space-between",height:`${g.size}px`}});export{y as FlowViewNode};const p=class extends L{init({nodeLabels:e,position:t}){this.element.setAttribute("tabindex",0),this.hint=this.createElement("input",`${p.cssClassName}__hint`);const i=this.input=this.createElement("input");this.options=this.createElement("div",[`${p.cssClassName}__options`]),this.nodeLabels=e,this.position=t,this._onDblclick=this.onDblclick.bind(this),this.element.addEventListener("dblclick",this._onDblclick),this._onPointerdown=this.onPointerdown.bind(this),this.element.addEventListener("pointerdown",this._onPointerdown),this._onKeydown=this.onKeydown.bind(this),i.addEventListener("keydown",this._onKeydown),this._onKeyup=this.onKeyup.bind(this),i.addEventListener("keyup",this._onKeyup)}dispose(){this.element.removeEventListener("dblclick",this._onDblclick),this.element.removeEventListener("pointerdown",this._onPointerdown),this.input.removeEventListener("keydown",this._onKeydown),this.input.removeEventListener("keyup",this._onKeyup)}focus(){this.input.focus()}get completion(){return this.hint.getAttribute("placeholder")}set completion(e){this.hint.setAttribute("placeholder",e)}get matchingNodeLabels(){const e=this.input.value;return e.length===0?[]:this.nodeLabels.filter(t=>t.startsWith(e)&&t!==e)}set position({x:e,y:t}){const{element:i,view:s}=this,o=t-s.origin.y+40>=s.height,r=e-s.origin.x+p.width>=s.width?s.width+s.origin.x-p.width-10:e,h=o?s.height+s.origin.y-50:t;i.style.top=`${h-s.origin.y}px`,i.style.left=`${r-s.origin.x}px`,this.x=r,this.y=h}get position(){return{x:this.x,y:this.y}}createNode(){this.view.newNode({x:this.position.x,y:this.position.y,label:this.input.value}),this.view.removeSelector()}onDblclick(e){e.stopPropagation()}onKeydown(e){switch(e.stopPropagation(),!0){case e.code==="Enter":this.createNode();break;case e.code==="Escape":this.input.value===""?this.view.removeSelector():this.input.value="";break;case e.code==="ArrowRight":const{completion:t,input:i}=this;t&&i.value.length===e.target.selectionStart&&(this.input.value=t);break;case e.code==="Tab":e.preventDefault(),this.completion&&(this.input.value=t);break;default:}}onKeyup(e){e.stopPropagation();const{input:t,options:i,matchingNodeLabels:s}=this;for(;i.firstChild;)i.removeChild(i.lastChild);for(let o=0;o<s.length;o++){const n=s[o],r=document.createElement("div");r.classList.add(`${p.cssClassName}__option`),r.textContent=n,r.onclick=()=>{this.input.value=n,this.createNode()},i.append(r)}switch(s.length){case 0:this.completion="";break;case 1:this.completion=s[0];break;default:let o=t.value;const n=s.reduce((r,h)=>r.length<h.length?r:h);for(let r=t.value.length;r<n.length;r++){const h=n[r];s.every(v=>v.startsWith(o+h))&&(o+=h)}this.completion=o}}onPointerdown(e){e.stopPropagation()}};let b=p;c(b,"cssClassName","fv-selector"),c(b,"zIndex",y.zIndex+1),c(b,"width",216),c(b,"padding",9),c(b,"style",{[`.${p.cssClassName}`]:{position:"absolute","box-shadow":l.boxShadow,"z-index":p.zIndex},[`.${p.cssClassName} input`]:{border:0,margin:0,outline:0,"border-radius":l.borderRadius,"font-family":l.fontFamily,"font-size":l.fontSize,padding:`${p.padding}px`,width:`${p.width-2*p.padding}px`},[`.${p.cssClassName}__hint`]:{position:"absolute",left:"0",background:"transparent","pointer-events":"none"},[`.${p.cssClassName}__hint::placeholder`]:{opacity:"0.4"},[`.${p.cssClassName}__options`]:{"background-color":l.nodeBackgroundColor,height:"fit-content"},[`.${p.cssClassName}__option`]:{padding:"0.5em",cursor:"default"}});const P=class extends HTMLElement{static generateStylesheet(e){return Object.entries(e).reduce((t,[i,s])=>[t,`${i}{`,Object.entries(s).map(([o,n])=>`${o}:${n};`).join(""),"}"].join(""),"")}static pointerCoordinates(e){const{clientX:t,clientY:i,target:s}=e,{left:o,top:n}=s.getBoundingClientRect(),r=Math.round(t-o),h=Math.round(i-n);return{x:r,y:h}}constructor(){super();const e=document.createElement("template");e.innerHTML=["<style>",P.generateStylesheet(P.style),"@media(prefers-color-scheme:dark){",P.generateStylesheet({":host":M("dark")}),"}","</style>"].join(""),this.attachShadow({mode:"open"}).appendChild(e.content.cloneNode(!0)),this._origin={x:0,y:0},this._nodes=new Map,this._edges=new Map,this.itemClass=new Map,Object.entries(P.defaultItems).forEach(([t,i])=>{this.itemClass.set(t,i)})}connectedCallback(){"ResizeObserver"in window?(this.rootResizeObserver=new ResizeObserver(this.onRootResize.bind(this)),this.rootResizeObserver.observe(this.parentNode)):this.height=this.getAttribute("height")||P.minHeight,this.getAttribute("tabindex")||this.setAttribute("tabindex",0),this.addEventListener("dblclick",this.onDblclick),this.addEventListener("keydown",this.onKeydown),this.addEventListener("pointerdown",this.onPointerdown),this.addEventListener("pointermove",this.onPointermove),this.addEventListener("pointerleave",this.onPointerleave),this.addEventListener("pointerup",this.onPointerup)}disconnectedCallback(){this.removeResizeObserver(),this.removeEventListener("dblclick",this.onDblclick),this.removeEventListener("keydown",this.onKeydown),this.removeEventListener("pointerdown",this.onPointerdown),this.removeEventListener("pointermove",this.onPointermove),this.removeEventListener("pointerleave",this.onPointerleave),this.removeEventListener("pointerup",this.onPointerup)}removeResizeObserver(){var e;this.parentNode&&((e=this.rootResizeObserver)==null||e.unobserve(this.parentNode)),delete this.rootResizeObserver}get origin(){return this.translateVector&&!this.hasSelectedNodes?{x:this._origin.x+this.translateVector.x,y:this._origin.y+this.translateVector.y}:this._origin}get selectedEdges(){return this.edges.filter(e=>e.isSelected)}get hasSelectedNodes(){return this.selectedNodes.length>0}get isDraggingEdge(){return this.semiEdge instanceof x}get selectedNodeIds(){return this.selectedNodes.map(e=>e.id)}get selectedNodes(){return this.nodes.filter(e=>e.isSelected)}get edges(){return Array.from(this._edges.values())}get nodes(){return Array.from(this._nodes.values())}get height(){return parseInt(this.style.height)}set height(e){this.style.height=`${e}px`}get width(){return parseInt(this.style.width)}set width(e){this.style.width=`${e}px`}clear(e){this.nodes.forEach(t=>{this.deleteNode(t.id,e)})}newEdge({id:e,source:t,target:i},s){const o=this.itemClass.get("edge"),n=new o({id:e,view:this,cssClassName:o.cssClassName,source:t,target:i});return this.addEdge(n),this.host.viewChange({createdEdge:n.toObject()},s),n}newNode({x:e=0,y:t=0,label:i="node",id:s,type:o,inputs:n=[],outputs:r=[]},h){const v=this.itemClass.get(o)||this.itemClass.get("node"),u=new v({id:s,view:this,cssClassName:v.cssClassName,label:i,inputs:n,outputs:r,x:e,y:t,type:o});return this.addNode(u),this.host.viewChange({createdNode:u.toObject()},h),u}selectEdge(e){e.highlight=!0,e.selected=!0,e.source.highlight=!0,e.target.highlight=!0}selectNode(e){e.highlight=!0,e.selected=!0;for(const t of e.inputs)t.highlight=!0;for(const t of e.outputs)t.highlight=!0;for(const t of this.edges)t.source.node.isSelected&&t.target.node.isSelected?this.selectEdge(t):this.deselectEdge(t)}deselectEdge(e){e.highlight=!1,e.selected=!1,e.source.node.isSelected||(e.source.highlight=!1),e.target.node.isSelected||(e.target.highlight=!1)}deselectNode(e){e.highlight=!1,e.selected=!1;for(const t of e.inputs)t.highlight=!1;for(const t of e.outputs)t.highlight=!1}addEdge(e){this._edges.set(e.id,e)}addNode(e){this._nodes.set(e.id,e)}deleteEdge(e,t){const i=this._edges.get(e);if(!i)return;i.source.highlight=!1,i.target.highlight=!1,this._edges.delete(i.id),i.remove();const s=i.toObject();return this.host.viewChange({deletedEdge:s},t),s}deleteNode(e,t){const i=this._nodes.get(e);if(!i)return;for(const o of this.edges)(o.source.node.id===i.id||o.target.node.id===i.id)&&this.deleteEdge(o.id,t);this._nodes.delete(i.id),i.remove();const s=i.toObject();return this.host.viewChange({deletedNode:s},t),s}edge(e){if(!this._edges.has(e))throw new $({kind:"edge",id:e});return this._edges.get(e)}node(e){if(!this._nodes.has(e))throw new $({kind:"node",id:e});return this._nodes.get(e)}startTranslation(e){if(this.startDraggingPoint=P.pointerCoordinates(e),this.translateVector={x:0,y:0},this.hasSelectedNodes){const t={};for(const i of this.selectedNodes)t[i.id]=i.position;this.selectedNodesStartPosition=t}}stopTranslation(){this.translateVector&&!this.hasSelectedNodes&&!this.semiEdge&&(this._origin={x:this._origin.x+this.translateVector.x,y:this._origin.y+this.translateVector.y}),delete this.translateVector,delete this.startDraggingPoint,delete this.selectedNodesStartPosition}createSelector({position:e}){return this.selector=new b({id:"selector",view:this,cssClassName:b.cssClassName,position:e,nodeLabels:Array.from(this.host.nodeLabels)})}updateNode({node:e}){this.host.viewChange({updatedNode:e.toObject()},viewChangeInfo)}onDblclick(e){this.clearSelection(),this.removeSelector();const t=P.pointerCoordinates(e);this.createSelector({position:{x:t.x+this.origin.x,y:t.y+this.origin.y}}).focus()}onKeydown(e){switch(e.stopPropagation(),!0){case this.selector instanceof b:return;case e.code==="Backspace":this.deleteSelectedItems();break;case e.code==="Escape":this.clearSelection();break;case"KeyU":this.undo();break;case"KeyR":this.redo();break;default:}}onPointerdown(e){e.stopPropagation(),this.removeSelector(),e.isBubblingFromNode||this.clearSelection(),this.startTranslation(e)}onPointermove(e){const{hasSelectedNodes:t,semiEdge:i,startDraggingPoint:s}=this;if(s){const o=P.pointerCoordinates(e),n=s.x-o.x,r=s.y-o.y;switch(!0){case!!i:{i.hasTarget||(i.target.center.x=o.x+this.origin.x,i.target.center.y=o.y+this.origin.y),i.updateGeometry();break}case t:{this.translateVector={x:n,y:r};const{edges:h,selectedNodes:v,selectedNodeIds:u,selectedNodesStartPosition:f}=this;for(const m of v){const{x:_,y:A}=f[m.id];m.position={x:_-n,y:A-r}}for(const m of h)(u.includes(m.source.node.id)||u.includes(m.target.node.id))&&m.updateGeometry();break}default:{this.translateVector={x:n,y:r};const{nodes:h,edges:v}=this;for(const u of h){const{x:f,y:m}=u.position;u.position={x:f,y:m}}for(const u of v)u.updateGeometry()}}}}onPointerleave(){this.stopTranslation()}onPointerup(){this.stopTranslation(),this.removeSemiEdge()}onRootResize(e){for(const t of e)if(this.parentNode===t.target){const i=Array.isArray(t.contentBoxSize)?t.contentBoxSize[0]:t.contentBoxSize;i?(this.width=i.inlineSize,this.height=i.blockSize):t.contentRect&&(this.width=t.contentRect.width,this.height=t.contentRect.height)}}createSemiEdge({source:e,target:t},i){const s=this.itemClass.get("edge");this.semiEdge=new s({view:this,cssClassName:s.cssClassName,source:e,target:t}),this.host.viewChange({createdSemiEdge:{from:e instanceof g?[e.node.id,e.id]:void 0,to:t instanceof g?[t.node.id,t.id]:void 0}},i)}clearSelection(){for(const e of this.selectedNodes)this.deselectNode(e);for(const e of this.selectedEdges)this.deselectEdge(e)}deleteSelectedItems(){for(const e of this.selectedEdges)this.deleteEdge(e.id);for(const e of this.selectedNodes)this.deleteNode(e.id)}removeSemiEdge(e){const{semiEdge:t}=this;if(!t)return;const{source:i,target:s}=t;t.remove(),delete this.semiEdge,this.host.viewChange({deletedSemiEdge:{from:i instanceof g?[i.node.id,i.id]:void 0,to:s instanceof g?[s.node.id,s.id]:void 0}},e)}removeSelector(){const{selector:e}=this;e instanceof b&&e.remove(),this.selector=void 0}};let S=P;c(S,"customElementName","flow-view"),c(S,"minHeight",200),c(S,"defaultItems",{edge:x,node:y}),c(S,"style",a(a(a(a({":host([hidden])":{display:"none"},":host":k(a({},M("light")),{position:"relative",display:"block",overflow:"hidden",border:0,margin:0,outline:0,"background-color":l.backgroundColor,"border-radius":l.borderRadius,"box-shadow":l.boxShadow,"font-family":l.fontFamily,"font-size":l.fontSize,color:l.textColor})},x.style),y.style),g.style),b.style));export{S as FlowViewElement};class K{static defineCustomElement(e){const{customElementName:t}=e;window.customElements.get(t)||window.customElements.define(t,e)}constructor({container:e,element:t,CustomElement:i=S}={}){if(K.defineCustomElement(i),t instanceof i)t.host=this,this.view=t;else{const s=this.view=document.createElement(i.customElementName);s.host=this,e instanceof HTMLElement?e.appendChild(s):document.body.appendChild(s)}this.view.style.isolation="isolate",this.nodeLabels=new Set,this._onViewChange=()=>{}}get graph(){const{view:{nodes:e,edges:t}}=this;return{nodes:e.map(i=>i.toObject()),edges:t.map(i=>i.toObject())}}destroy(){this.view.parentNode.removeChild(this.view)}node(e){return this.view.node(e)}edge(e){return this.view.edge(e)}addNodeLabels(e){e.forEach(t=>this.nodeLabels.add(t))}clearGraph(){this.view.clear({isClearGraph:!0})}loadGraph({nodes:e=[],edges:t=[]}){for(const i of e)this.newNode(i,{isLoadGraph:!0});for(const i of t)this.newEdge(i,{isLoadGraph:!0})}get onViewChange(){return this._onViewChange}onChange(e){this._onViewChange=e}viewChange({createdNode:e,createdEdge:t,createdSemiEdge:i,deletedNode:s,deletedEdge:o,deletedSemiEdge:n,updatedNode:r},h={}){e&&this.onViewChange({action:"CREATE_NODE",data:e},h),t&&this.onViewChange({action:"CREATE_EDGE",data:t},h),i&&this.onViewChange({action:"CREATE_SEMI_EDGE",data:i},h),s&&this.onViewChange({action:"DELETE_NODE",data:s},h),o&&this.onViewChange({action:"DELETE_EDGE",data:o},h),n&&this.onViewChange({action:"DELETE_SEMI_EDGE",data:n},h),r&&this.onViewChange({action:"UPDATE_NODE",data:r},h)}newEdge({id:e,from:[t,i],to:[s,o]},n={isProgrammatic:!0}){const r=this.view.node(t),h=this.view.node(s),v=r.output(i),u=h.input(o);return this.view.newEdge({id:e,source:v,target:u},n)}newNode(e,t={isProgrammatic:!0}){return this.view.newNode(e,t)}deleteNode(e,t={isProgrammatic:!0}){return this.view.deleteNode(e,t)}deleteEdge(e,t={isProgrammatic:!0}){return this.view.deleteEdge(e,t)}addNodeClass(e,t){this.view.itemClass.set(e,t)}}export{K as FlowView};
