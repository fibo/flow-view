// http://g14n.info/flow-view
require=function(){return function t(e,s,n){function i(r,d){if(!s[r]){if(!e[r]){var a="function"==typeof require&&require;if(!d&&a)return a(r,!0);if(o)return o(r,!0);var h=new Error("Cannot find module '"+r+"'");throw h.code="MODULE_NOT_FOUND",h}var c=s[r]={exports:{}};e[r][0].call(c.exports,function(t){return i(e[r][1][t]||t)},c,c.exports,t,e,s,n)}return s[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)i(n[r]);return i}}()({1:[function(t,e,s){e.exports=s.default=function(t){Array.prototype.slice.call(arguments,1).forEach(function(e){t[e]?t[e]=t[e].bind(t):console.error("Method "+e+" is not defined")})}},{}],2:[function(t,e,s){e.exports=function(t){t.preventDefault(),t.stopPropagation()}},{}],3:[function(t,e,s){e.exports=s.default=function(t){return function(e,s){var n={};for(var i in e){var o={configurable:!1,enumerable:s},r=e[i];"function"==typeof r?o.get=r:(o.value=r,o.writable=!1),n[i]=o}Object.defineProperties(t,n)}}},{}],4:[function(t,e,s){const n=t("static-props"),i=t("./localStored"),o=t("./Creator"),r=t("./Inspector"),d=t("./Root");e.exports=class{constructor(t){this.theme={frame:{fontFamily:'-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"',fontSize:14},inspector:{button:{color:"darkgray",size:12},baseColor:"gainsboro"},link:{baseColor:"darkgray",highlightColor:"mediumaquamarine",width:2},node:{backgroundColor:"white",baseColor:"gainsboro",highlightColor:"#A9DFBF"},pin:{baseColor:"darkgray",highlightColor:"mediumaquamarine",inspectedColor:"mediumseagreen",size:8},selection:{color:"#A9DFBF"}},this.state={creator:Object.assign({},o.defaultState),currentPin:null,draggingItems:!1,draggingLink:!1,draggedLinkCoordinates:null,draggedLinkId:null,draggedLinkType:null,graph:{links:[],nodes:[]},inspector:Object.assign({},r.defaultState,i("inspector").getItem()),multiSelection:!1,selected:{links:[],nodes:[]}};let e=Function.prototype;const s=new d(this,(a=this,function(t,s){try{a[t](s)}catch(e){throw console.error(`action ${t}`),e}e(a.state)}),t);var a;this.state.root=s.boundingRect,e=s.render.bind(s),n(this)({root:s})}blurPin(){this.state.currentPin=null}attachHalfLink({id:t,from:e,to:s}){const n=this.state.graph.links.findIndex(e=>e.id===t);n>-1&&(e?this.state.graph.links[n].from=e:s&&(this.state.graph.links[n].to=s),this.state.draggingLink=null,this.state.draggedLinkCoordinates=null,this.state.draggedLinkId=null,this.state.draggedLinkType=null)}createHalfLink(t){const e=this.generateId();this.state.draggingLink=!0,this.state.draggedLinkCoordinates=t.cursorCoordinates,this.state.draggedLinkId=e,this.state.draggedLinkType=t.type,this.state.graph.links.push({id:e,from:t.from,to:t.to}),this.resetSelection()}createLink(t){t.id=this.generateId(),this.state.graph.links.push(t)}createNode(t){t.id=this.generateId(),this.state.graph.nodes.push(t),this.hideCreator()}createPin({nodeId:t,type:e,position:s,pin:n}){const{nodes:i}=this.state.graph,o=`${e}s`,r=i.findIndex(e=>e.id===t);void 0===i[r][o]&&(i[r][o]=[]),i[r][o].splice(s,0,n)}deleteHalfLink(){const t=this.state.draggedLinkId;this.state.draggingLink=null,this.state.draggedLinkCoordinates=null,this.state.draggedLinkId=null,this.state.draggedLinkType=null;const e=this.state.graph.links.findIndex(({id:e})=>e===t);this.state.graph.links.splice(e,1)}deleteLink(t){const{links:e}=this.state.graph,s=e.findIndex(({id:e})=>e===t);e.splice(s,1)}deleteNode(t){const{links:e,nodes:s}=this.state.graph,n=s.findIndex(({id:e})=>e===t);s.splice(n,1),e.reduce((e,s)=>{const{from:n,to:i}=s;return n&&n[0]===t||i&&i[0]===t?e.concat(s.id):e},[]).forEach(t=>this.deleteLink(t))}deletePin({type:t,nodeId:e,position:s}){const{links:n,nodes:i}=this.state.graph,o=`${t}s`;i[i.findIndex(t=>t.id===e)][o].splice(s,1),n.reduce((t,n)=>{const{from:i,to:o}=n;return i&&i[0]===e&&i[1]===s||o&&o[0]===e&&o[1]===s?t.concat(n.id):t},[]).forEach(t=>this.deleteLink(t))}deleteSelection(){const{links:t,nodes:e}=this.state.selected;t.forEach(t=>this.deleteLink(t)),e.forEach(t=>this.deleteNode(t)),this.resetSelection()}deselectNode(t){const e=this.state.selected.nodes.indexOf(t);e>-1&&this.state.selected.nodes.splice(e,1),this.hideCreator()}disableMultiSelection(){this.state.multiSelection=!1}dragItems({x:t,y:e}){const{graph:s,selected:n}=this.state;s.nodes.filter(({id:t})=>n.nodes.indexOf(t)>-1).forEach(s=>{s.x+=t,s.y+=e})}dragLink(t){this.state.draggedLinkCoordinates=t}enableMultiSelection(){this.state.multiSelection=!0}focusPin(t){this.state.currentPin=t}generateId(){let t="";for(;t.length<3;)t+=String.fromCharCode(97+Math.floor(26*Math.random()));return t}hideCreator(){this.state.creator.hidden=!0}hideInspector(){this.state.inspector.hidden=!0,i("inspector").assign({hidden:!0})}loadGraph(t){this.state.graph=t,this.root.render(this.state)}pinInspector(){this.state.inspector.pinned=!0,i("inspector").assign({pinned:!0})}renameNode({id:t,name:e}){const{nodes:s}=this.state.graph;s[s.findIndex(e=>e.id===t)].name=e}renamePin({type:t,nodeId:e,position:s,name:n}){const{nodes:i}=this.state.graph,o=i.findIndex(t=>t.id===e);this.state.graph.nodes[o][`${t}s`][s].name=n}resize(t){this.state.root=t}selectLink(t){const{graph:e,multiSelection:s,selected:n}=Object.assign({},this.state);-1===n.links.indexOf(t)&&(s?n.links.push(t):(this.resetSelection(),n.links=[t])),this.state.graph.links=e.links,this.state.selected.links=n.links,this.hideCreator()}selectNode(t){const{graph:e,multiSelection:s,selected:n}=Object.assign({},this.state);-1===n.nodes.indexOf(t)&&(s?n.nodes.push(t):(this.resetSelection(),n.nodes=[t])),this.state.graph.nodes=e.nodes,this.state.selected.nodes=n.nodes,this.hideCreator()}resetSelection(){this.state.selected={links:[],nodes:[]},this.hideCreator(),this.stopDraggingItems()}showCreator({x:t,y:e}){this.state.creator={hidden:!1,x:t,y:e}}showInspector(){this.state.inspector.hidden=!1,i("inspector").assign({hidden:!1})}startDraggingItems(){this.state.draggingItems=!0}stopDraggingItems(){this.state.draggingItems=!1}unpinInspector(){this.state.inspector.pinned=!1,i("inspector").assign({pinned:!1})}}},{"./Creator":6,"./Inspector":10,"./Root":20,"./localStored":23,"static-props":3}],5:[function(t,e,s){const n=t("bindme"),i=t("pdsp"),o=t("static-props");e.exports=class{constructor(t,e,s){o(this)({canvas:t,component:{},container:s,dispatch:()=>e}),n(this,"dropEvent")}createElement(t,e){const s=document.createElement(t);return e?e.appendChild(s):this.container.appendChild(s),s}dropEvent(t){i(t)}hide(){this.container.style.display="none"}render(t){this.renderAllSubComponents(t)}renderAllSubComponents(t){const e=this.component;Object.getOwnPropertyNames(e).forEach(function(s){e[s].render(t)})}show(){this.container.style.display=""}}},{bindme:1,pdsp:2,"static-props":3}],6:[function(t,e,s){const n=t("bindme"),i=t("static-props"),o=t("./SvgComponent");class r extends o{constructor(t,e,s){super(t,e,s),this.hide();const o=this.createElement("input");o.setAttribute("type","text"),o.style.outline="none",i(this)({input:o}),n(this,"onInputKeypress"),o.addEventListener("keypress",this.onInputKeypress)}onInputKeypress(t){const{dispatch:e,input:s,x:n,y:i}=this,o=t.target.value;switch(t.key){case"Enter":e("createNode",{name:o,x:n,y:i}),s.value=""}}render(t){const{canvas:e,container:s,input:n}=this,{hidden:i,x:o,y:r}=t.creator,{fontFamily:d,fontSize:a}=e.theme.frame,h=this.fontSize!==a||this.fontFamily!==d,c=this.hidden!==i;h&&(n.style.fontFamily=d,n.style.fontSize=a),c&&(i?s.style.display="none":(this.x=o,this.y=r,s.setAttribute("x",o),s.setAttribute("y",r),s.style.display="",n.focus()),this.hidden=i)}}i(r)({defaultState:{hidden:!0,x:0,y:0}}),e.exports=r},{"./SvgComponent":22,bindme:1,"static-props":3}],7:[function(t,e,s){const n=t("bindme"),i=t("static-props"),o=t("./Component");e.exports=class extends o{constructor(t,e,s){super(t,e,s);const o=this.createElement("span");o.style.cursor="text";const r=this.createElement("input");r.style.cursor="none",r.style.display="none",n(this,"onBlurEditor","onClickLabel","onKeydownEditor","onMouseLeaveEditor"),r.addEventListener("blur",this.onBlurEditor),r.addEventListener("keydown",this.onKeydownEditor),r.addEventListener("keyup",this.dropEvent),r.addEventListener("mouseleave",this.onMouseLeaveEditor),o.addEventListener("click",this.onClickLabel),i(this)({editor:r,label:o})}onBlurEditor(){this.submit()}onClickLabel(){this.editable&&this.startEditing()}onKeydownEditor(t){switch(t.stopPropagation(),t.key){case"Escape":this.stopEditing();break;case"Enter":this.submit()}}onMouseLeaveEditor(){this.stopEditing()}startEditing(){const{editor:t,label:e,text:s}=this;t.style.display="",e.style.display="none",t.value=s,t.focus()}stopEditing(){const{editor:t,label:e}=this;t.style.display="none",t.value="",e.style.display=""}render(t){const{label:e}=this,{editable:s,text:n}=t;this.editable=s,this.text!==n&&(this.text=n,e.innerHTML=n)}submit(){const{action:t,editor:e}=this,s=e.value.trim();"function"==typeof t&&""!==s&&t(s),this.stopEditing()}}},{"./Component":5,bindme:1,"static-props":3}],8:[function(t,e,s){const n=t("bindme"),i=t("pdsp"),o=t("static-props"),r=t("./SvgComponent"),d=t("./Creator"),a=t("./InspectorToggle"),h=t("./Link"),c=t("./Node"),l=(t,e,s,n)=>Math.sqrt((s-t)*(s-t)+(n-e)*(n-e));e.exports=class extends r{constructor(t,e,s){super(t,e,s),this.linkRef={},this.nodeRef={};const i=this.createElementNS("svg");i.style.cursor="default",this.selectedNodesBounds={};const r=this.createElementNS("rect",i);r.setAttribute("fill","transparent"),r.setAttribute("stroke-dasharray","10 10");const h=this.createElementNS("g",i),c=this.createElementNS("g",i),l=this.createElementNS("foreignObject",i),p=new d(t,e,l),u=this.createElementNS("foreignObject",i),g=new a(t,e,u);o(this)({linksGroup:h,nodesGroup:c,selection:r,svg:i}),o(this.component)({creator:p,inspectorToggle:g}),n(this,"onDblclick","onKeydownDocument","onKeyupDocument","onMousedown","onMouseleave","onMousemove","onMouseup"),document.addEventListener("keydown",this.onKeydownDocument),document.addEventListener("keyup",this.onKeyupDocument),i.addEventListener("dblclick",this.onDblclick),i.addEventListener("mousedown",this.onMousedown),i.addEventListener("mouseleave",this.onMouseleave),i.addEventListener("mouseup",this.onMouseup),i.addEventListener("mousemove",this.onMousemove)}getCoordinates(t){const{left:e,top:s}=this.svg.getBoundingClientRect();return{x:t.clientX-e,y:t.clientY-s}}isCloseToLink(t,e,s){const{linkRef:n}=this,{startX:i,endX:o,startY:r,endY:d}=n[t];return l(e,s,o,d)+l(e,s,i,r)<l(i,r,o,d)+.4}isInsideRectangularSelection(t,e){const{selectedNodesBounds:s}=this;return Object.keys(s).length>0&&t>=s.x1&&t<=s.x2&&e>=s.y1&&e<=s.y2}onDblclick(t){const{dispatch:e,linkRef:s}=this,{creator:n}=this.component,{x:i,y:o}=this.cursorCoordinates=this.getCoordinates(t);let r;return Object.keys(s).forEach(t=>{r||this.isCloseToLink(t,i,o)&&(r=t)}),r?e("deleteLink",r):n.hidden?e("showCreator",{x:i,y:o}):void 0}onKeydownDocument(t){const{dispatch:e}=this;switch(t.key){case"Backspace":e("deleteSelection");break;case"Escape":e("resetSelection");break;case"Shift":e("enableMultiSelection")}}onKeyupDocument(t){const{dispatch:e}=this;switch(t.key){case"Shift":e("disableMultiSelection")}}onMousedown(t){i(t);const{dispatch:e,linkRef:s}=this,{x:n,y:o}=this.cursorCoordinates=this.getCoordinates(t);if(this.isInsideRectangularSelection(n,o))return e("startDraggingItems");let r;if(Object.keys(s).forEach(t=>{r||this.isCloseToLink(t,n,o)&&(r=t)}),r)return e("selectLink",r);e("resetSelection")}onMouseleave(t){const{dispatch:e,draggingItems:s}=this;s&&e("stopDraggingItems")}onMousemove(t){const{cursorCoordinates:e,dispatch:s,draggingLink:n,draggingItems:i,selectedNodesBounds:o}=this;if(i){const n=this.getCoordinates(t);let i={x:n.x-e.x,y:n.y-e.y};o.x1+i.x<=0&&(i.x=0),o.y1+i.y<=0&&(i.y=0),this.cursorCoordinates=n,s("dragItems",i)}n&&s("dragLink",this.getCoordinates(t))}onMouseup(t){i(t);const{dispatch:e,draggingLink:s,draggingItems:n}=this;this.setCursorCoordinates(t);const{x:o,y:r}=this.cursorCoordinates;return n&&this.isInsideRectangularSelection(o,r)?e("stopDraggingItems"):s?e("deleteHalfLink"):void 0}render(t){const{canvas:e,dispatch:s,linksGroup:n,nodesGroup:i,selection:o,svg:r}=this,{currentPin:d,draggingItems:a,draggedLinkCoordinates:l,draggedLinkType:p,draggedLinkId:u,draggingLink:g,graph:m,inspector:f,root:b,textSize:y}=t;this.draggingItems=a,this.draggingLink=g;const k=u?m.links.find(t=>t.id===u):null;this.draggedLink=k;const x=t.selected.links,v=t.selected.nodes,{fontFamily:C,fontSize:L}=e.theme.frame,E=e.theme.pin.size/2,I=b.height,S=f.hidden?b.width:b.width-f.width,w=v.length>1,A=v.length>0?v.map(t=>this.nodeRef[t]).reduce((t,e)=>({x1:Math.min(t.x1,e.x),y1:Math.min(t.y1,e.y),x2:Math.max(t.x2,e.x+e.width),y2:Math.max(t.y2,e.y+e.height)}),{x1:1/0,y1:1/0,x2:-1/0,y2:-1/0}):{},M=this.fontSize!==L||this.fontFamily!==C,R=this.height!==I,$=A.x1!==this.selectedNodesBounds.x1||A.y1!==this.selectedNodesBounds.y1||A.x2!==this.selectedNodesBounds.x2||A.y2!==this.selectedNodesBounds.y2,P=this.width!==S;M&&(r.setAttribute("font-family",C),r.setAttribute("font-size",L)),P&&r.setAttribute("width",S),R&&r.setAttribute("height",I),$&&(this.selectedNodesBounds=A),w?(o.setAttribute("stroke",e.theme.selection.color),$&&(o.setAttribute("x",A.x1),o.setAttribute("y",A.y1),o.setAttribute("height",A.y2-A.y1),o.setAttribute("width",A.x2-A.x1))):o.setAttribute("stroke","transparent"),Object.keys(this.nodeRef).forEach(t=>{m.nodes.find(e=>e.id===t)||(i.removeChild(this.nodeRef[t].container),delete this.nodeRef[t])});const N={},O={};m.links.forEach(({from:t,to:e})=>{if(t){const[e,s]=t;void 0===O[e]?O[e]=[s]:O[e].push(s)}if(e){const[t,s]=e;void 0===N[t]?N[t]=[s]:N[t].push(s)}}),m.nodes.forEach(t=>{const{id:n}=t,o=v.indexOf(n)>-1,r={connectedIns:N[n]||[],connectedOuts:O[n]||[],currentPin:d&&d.nodeId===n?d:null,draggedLink:k,draggedLinkType:p,draggingLink:g,graph:t,selected:o,textSize:y[n]},h=this.nodeRef[n];if(h)o&&!a&&(i.removeChild(h.container),i.appendChild(h.container)),h.render(r);else{const t=this.createElementNS("g",i);t.setAttribute("id",n);const o=new c(e,this,s,t);o.render(r),this.nodeRef[n]=o}}),Object.keys(this.linkRef).forEach(t=>{m.links.find(e=>e.id===t)||(n.removeChild(this.linkRef[t].container),delete this.linkRef[t])}),m.links.forEach(t=>{const{id:i,from:o,to:r}=t,d=o?this.nodeRef[o[0]]:null,a=r?this.nodeRef[r[0]]:null,c=d?d.getOutRefByPosition(o[1]):null,p=a?a.getInRefByPosition(r[1]):null,u=x.indexOf(i)>-1,g={endX:p?a.x+p.x+E:l.x,endY:p?a.y+E:l.y,graph:t,selected:u||d&&a&&d.selected&&a.selected,startX:c?d.x+c.x+E:l.x,startY:c?d.y+c.y+E:l.y},m=this.linkRef[i];if(m)m.render(g);else{const t=this.createElementNS("g",n);t.setAttribute("id",i);const o=new h(e,s,t);o.render(g),this.linkRef[i]=o}}),this.renderAllSubComponents(t)}setCursorCoordinates(t){this.cursorCoordinates=this.getCoordinates(t)}}},{"./Creator":6,"./InspectorToggle":15,"./Link":16,"./Node":17,"./SvgComponent":22,bindme:1,pdsp:2,"static-props":3}],9:[function(t,e,s){const n=t("bindme"),i=t("pdsp"),o=t("./Pin");e.exports=class extends o{constructor(t,e,s,i,o,r){super(t,e,s,i,o,r),n(this,"onMousedown","onMouseover","onMouseup"),i.addEventListener("mousedown",this.onMousedown),i.addEventListener("mouseover",this.onMouseover),i.addEventListener("mouseup",this.onMouseup)}onMousedown(t){i(t),console.log("create link")}onMouseover(t){i(t);const{dispatch:e,nodeId:s,position:n}=this;e("focusPin",{type:"in",nodeId:s,position:n})}onMouseup(t){i(t);const{connected:e,dispatch:s,frame:n,highlighted:o,nodeId:r,position:d}=this;n.draggingLink&&n.draggedLink.from&&(e?s("deleteHalfLink"):o?s("attachHalfLink",{id:n.draggedLink.id,to:[r,d]}):s("deleteHalfLink"))}render(t){super.render(t)}}},{"./Pin":19,bindme:1,pdsp:2}],10:[function(t,e,s){const n=t("bindme"),i=t("static-props"),o=t("./Component"),r=t("./EditableText"),d=t("./InspectorPinList");class a extends o{constructor(t,e,s){super(t,e,s);const o=this.createElement("botton");o.style.cursor="default";const a=this.createElement("div"),h=new r(t,e,a),c=this.createElement("div"),l=new d(t,e,c,"in"),p=this.createElement("div"),u=new d(t,e,p,"out");n(this,"onClickPin","onMouseLeave"),s.addEventListener("mouseleave",this.onMouseLeave),o.addEventListener("click",this.onClickPin),i(this)({inputList:l,outputList:u,label:h,pin:o})}onClickPin(){const t=this.pinned?"unpinInspector":"pinInspector";this.dispatch(t)}onMouseLeave(){this.pinned||this.dispatch("hideInspector")}render(t){const{canvas:e,container:s,dispatch:n,inputList:i,label:o,outputList:r,pin:d}=this,{graph:a,inspector:h,selected:c}=t,{hidden:l,pinned:p,width:u}=h,g=e.theme.inspector,{baseColor:m}=g,f=a.nodes.filter(({id:t})=>c.nodes.indexOf(t)>-1),b=f.length,y=this.baseColor!==m,k=this.pinned!==p,x=!p&&this.hidden!==l,v=this.width!==u;if(x&&(this.hidden=l,s.style.display=l?"none":""),!l)if(k&&(this.pinned=p,d.innerHTML=p?"âŒ":"ðŸ“Œ"),y&&(this.baseColor=m,s.style.backgroundColor=m),v&&(this.width=u,s.style.width=`${u}px`),1===b){const t=f[0];o.action=(e=>{n("renameNode",{id:t.id,name:e})}),o.render({editable:!0,text:t.name}),i.show();const e=t.ins||[];i.render({nodeId:t.id,pins:e,theme:g}),r.show();const s=t.outs||[];r.render({nodeId:t.id,pins:s,theme:g})}else delete o.action,i.hide(),i.render({pins:[],theme:g}),r.hide(),r.render({pins:[],theme:g}),0===b&&o.render({editable:!1,text:"(no node selected)"}),1===b&&o.render({editable:!1,text:`(${b} node)`}),b>1&&o.render({editable:!1,text:`(${b} nodes)`})}}i(a)({defaultState:{hidden:!0,pinned:!1,width:170}}),e.exports=a},{"./Component":5,"./EditableText":7,"./InspectorPinList":14,bindme:1,"static-props":3}],11:[function(t,e,s){const n=t("./SvgButton");e.exports=class extends n{setShape(t){const{path:e}=this,s=t/6,n=Math.sqrt(2)*s/2;e.setAttribute("d",`M 0 ${3*s-n} V ${3*s+n} H ${3*s-n} V ${t} H ${3*s+n} V ${3*s+n} H ${t} V ${3*s-n} H ${3*s+n} V 0 H ${3*s-n} V ${3*s-n} Z`)}}},{"./SvgButton":21}],12:[function(t,e,s){const n=t("./SvgButton");e.exports=class extends n{setShape(t){const{path:e}=this,s=t/6;e.setAttribute("d",`M ${4*s} ${3*s} L ${6*s} ${s} L ${5*s} 0 L ${3*s} ${2*s} L ${s} 0 L 0 ${s} L ${2*s} ${3*s} L 0 ${5*s} L ${s} ${6*s} L ${3*s} ${4*s} L ${5*s} ${6*s} L ${6*s} ${5*s} Z`)}}},{"./SvgButton":21}],13:[function(t,e,s){const n=t("bindme"),i=t("pdsp"),o=t("static-props"),r=t("./Component"),d=t("./EditableText"),a=t("./InspectorDelPinButton");e.exports=class extends r{constructor(t,e,s){super(t,e,s);const i=this.createElement("div"),r=new a(t,e,i);r.svg.style.marginLeft="1em",r.svg.style.marginRight="4px";const h=new d(t,e,i);n(this,"onClickDelete"),r.svg.addEventListener("click",this.onClickDelete),o(this)({delButton:r,label:h})}onClickDelete(t){i(t);const{dispatch:e,nodeId:s,position:n,type:o}=this;e("deletePin",{type:o,nodeId:s,position:n})}render(t){const{delButton:e,dispatch:s,label:n}=this,{nodeId:i,pin:o,position:r,type:d,theme:a}=t,{name:h}=o,c=this.name!==h,l=this.nodeId!==i,p=this.position!==r,u=this.type!==d;e.render({theme:a.button}),l&&(this.nodeId=i),p&&(this.position=r),u&&(this.type=d),c&&(n.render({editable:!0,text:h}),this.name=h),(l||p)&&(n.action=(t=>{s("renamePin",{type:d,nodeId:i,position:r,name:t})}))}}},{"./Component":5,"./EditableText":7,"./InspectorDelPinButton":12,bindme:1,pdsp:2,"static-props":3}],14:[function(t,e,s){const n=t("bindme"),i=t("static-props"),o=t("pdsp"),r=t("./Component"),d=t("./InspectorPinEditor"),a=t("./InspectorAddPinButton");e.exports=class extends r{constructor(t,e,s,o){super(t,e,s),this.pinEditorRef=[];const r=new a(t,e,s);r.svg.style.marginLeft="4px",r.svg.style.marginRight="4px";const d=this.createElement("div");d.style.cursor="default",d.style.display="inline-block",d.style.lineHeight="1.5em";const h=this.createElement("div");n(this,"onClickAdd"),r.svg.addEventListener("click",this.onClickAdd),i(this)({info:d,pinList:h,type:o}),i(this.component)({addButton:r})}createPinEditor(t,e){const{canvas:s,dispatch:n,pinList:i}=this,o=this.createElement("div",i),r=new d(s,n,o);r.render(t),this.pinEditorRef.splice(e,0,r)}deletePinEditor(t){const{pinList:e,pinEditorRef:s}=this;e.removeChild(e.childNodes[t]),s.splice(t,1)}onClickAdd(t){o(t);const{dispatch:e,nodeId:s,numPins:n,type:i}=this,r=n+1;e("createPin",{nodeId:s,type:i,position:r,pin:{name:`${i}${r}`}})}render(t){const{info:e,pinList:s,type:n}=this,{addButton:i}=this.component,{nodeId:o,pins:r,theme:d}=t,a=r.length,h=o!==this.nodeId,c=a!==this.numPins;i.render({theme:d.button}),h&&(this.nodeId=o),c&&(this.numPins=a),c&&(0===a&&(e.innerHTML=`no ${n}put`),1===a&&(e.innerHTML=`one ${n}put`),a>1&&(e.innerHTML=`${a} ${n}puts`));for(let t=a;t<s.childElementCount;t++)this.deletePinEditor(t);for(let t=0;t<a;t++){const e=this.pinEditorRef[t],s={nodeId:o,pin:r[t],position:t,type:n,theme:d};e?e.render(s):this.createPinEditor(s,t)}}}},{"./Component":5,"./InspectorAddPinButton":11,"./InspectorPinEditor":13,bindme:1,pdsp:2,"static-props":3}],15:[function(t,e,s){const n=t("bindme"),i=t("static-props"),o=t("./SvgComponent");e.exports=class extends o{constructor(t,e,s){super(t,e,s);const o=this.createElement("div");o.innerHTML="ðŸ‘",o.style.fontSize=15,o.style.padding=2,n(this,"onMouseEnter"),o.addEventListener("mouseenter",this.onMouseEnter),i(this)({toggle:o})}onMouseEnter(){this.dispatch("showInspector")}render(t){const{toggle:e}=this,s=t.inspector.hidden;this.hidden!==!s&&(this.hidden=!s,e.style.display=s?"":"none")}}},{"./SvgComponent":22,bindme:1,"static-props":3}],16:[function(t,e,s){const n=t("bindme"),i=t("pdsp"),o=t("static-props"),r=t("./SvgComponent");e.exports=class extends r{constructor(t,e,s){super(t,e,s);const i=this.createElementNS("path"),r=this.createElementNS("circle"),d=this.createElementNS("circle");o(this)({end:d,line:i,id:()=>s.getAttribute("id"),start:r,theme:()=>t.theme.link}),n(this,"onClick","onDblclick"),s.addEventListener("click",this.onClick),s.addEventListener("dblclick",this.onDblclick),s.addEventListener("mousedown",this.dropEvent)}onClick(t){i(t);const{id:e,dispatch:s}=this;s("selectLink",e)}onDblclick(t){i(t);const{id:e,dispatch:s}=this;s("deleteLink",e)}render(t){const{canvas:e,line:s,start:n,end:i}=this,{endX:o,endY:r,selected:d,startX:a,startY:h}=t,c=e.theme.pin.size,{baseColor:l,highlightColor:p,width:u}=this.theme,g=o!==this.endX,m=r!==this.endY,f=c!==this.pinSize,b=d!==this.selected,y=a!==this.startX,k=h!==this.startY;u!==this.width&&(this.width=u,s.setAttribute("stroke-width",u)),b&&(this.selected=d,d?(s.setAttribute("stroke",p),n.setAttribute("fill",p),i.setAttribute("fill",p)):(s.setAttribute("stroke",l),n.setAttribute("fill",l),i.setAttribute("fill",l))),y&&(this.startX=a,n.setAttribute("cx",a)),k&&(this.startY=h,n.setAttribute("cy",h)),g&&(this.endX=o,i.setAttribute("cx",o)),m&&(this.endY=r,i.setAttribute("cy",r)),(y||k||g||m)&&s.setAttribute("d",`M ${a} ${h} L ${o} ${r}`),f&&(this.pinSize=c,n.setAttribute("r",c/2),i.setAttribute("r",c/2))}}},{"./SvgComponent":22,bindme:1,pdsp:2,"static-props":3}],17:[function(t,e,s){const n=t("bindme"),i=t("pdsp"),o=t("static-props"),r=t("./SvgComponent"),d=t("./In"),a=t("./Out");class h extends r{constructor(t,e,s,i){super(t,s,i),this.inRef={},this.outRef={};const r=this.createElementNS("rect");r.setAttribute("stroke-width",1);const d=this.createElementNS("rect"),a=this.createElementNS("rect"),h=this.createElementNS("text");h.setAttribute("text-anchor","middle"),n(this,"onMousedown","onMouseup"),i.addEventListener("click",this.dropEvent),i.addEventListener("dblclick",this.dropEvent),i.addEventListener("mousedown",this.onMousedown),i.addEventListener("mouseup",this.onMouseup),o(this)({bottombar:a,container:i,frame:e,label:h,id:()=>i.getAttribute("id"),numIns:()=>Object.keys(this.inRef).length,numOuts:()=>Object.keys(this.outRef).length,rect:r,theme:()=>t.theme.node,topbar:d})}generateInId(t){return`${this.id}-i${t}`}generateOutId(t){return`${this.id}-o${t}`}getInRefByPosition(t){const e=this.generateInId(t);return this.inRef[e]}getOutRefByPosition(t){const e=this.generateOutId(t);return this.outRef[e]}onMousedown(t){const{dispatch:e,id:s}=this;e("selectNode",s)}onMouseup(t){i(t);const{dispatch:e,frame:s}=this;return s.draggingItems?e("stopDraggingItems"):s.draggingLink?e("deleteHalfLink"):void 0}render(t){const{bottombar:e,canvas:s,container:n,dispatch:i,frame:o,id:r,label:h,rect:p,topbar:u}=this,{backgroundColor:g,baseColor:m,highlightColor:f}=this.theme,b=s.theme.pin.size,y=s.theme.frame.fontSize,{connectedIns:k,connectedOuts:x,currentPin:v,draggedLink:C,draggedLinkType:L,draggingLink:E,graph:I,selected:S,textSize:w}=t,{ins:A,outs:M,name:R,x:$,y:P}=Object.assign({},l,I),{height:N,width:O}=c(w,b,I.height,I.width),z=g!==this.backgroundColor,B=y!==this.fontSize,D=b!==this.pinSize,T=N!==this.height,H=R!==this.text,j=A.length!==this.numIns,F=M.length!==this.numOuts,K=S!==this.selected,X=O!==this.width,Y=$!==this.x,q=P!==this.y;(Y||q)&&(this.x=$,this.y=P,n.setAttributeNS(null,"transform",`translate(${$},${P})`)),D&&(this.pinSize=b,e.setAttribute("height",b),u.setAttribute("height",b)),T&&(this.height=N,p.setAttribute("height",N)),(T||D)&&e.setAttribute("transform",`translate(0,${N-b})`),(T||B)&&h.setAttribute("y",Math.round(N/2)+y/3),X&&(this.width=O,e.setAttribute("width",O),h.setAttribute("x",Math.round(O/2)),p.setAttribute("width",O),u.setAttribute("width",O)),H&&(this.name=R,h.textContent=R),z&&(this.backgroundColor=g,p.setAttribute("fill",g)),K&&(this.selected=S,S?(e.setAttribute("fill",f),p.setAttribute("stroke",f),u.setAttribute("fill",f)):(e.setAttribute("fill",m),p.setAttribute("stroke",m),u.setAttribute("fill",m)));for(let t=A.length;t<this.numIns;t++){const e=this.generateInId(t);this.inRef[e].container.remove()}A.forEach((t,e)=>{const n=this.generateInId(e),a=t.type||null,h={connected:k.indexOf(e)>-1,graph:t,highlighted:!!E&&(void 0!==C.from&&L===a),inspected:v&&"in"===v.type&&v.position===e,node:{heightChanged:T,height:N,numPins:A.length,numPinsChanged:j,width:O,widthChanged:X},position:e,selected:S},c=this.inRef[n];if(c)c.render(h);else{const t=this.createElementNS("rect"),a=new d(s,o,i,t,r,e);a.render(h),this.inRef[n]=a}});for(let t=M.length;t<this.numOuts;t++){const e=this.generateOutId(t);this.outRef[e].container.remove()}M.forEach((t,e)=>{const n=this.generateOutId(e),d=t.type||null,h={connected:x.indexOf(e)>-1,graph:t,highlighted:!!E&&(void 0!==C.to&&L===d),inspected:v&&"out"===v.type&&v.position===e,node:{heightChanged:T,height:N,numPins:M.length,numPinsChanged:F,width:O,widthChanged:X},position:e,selected:S},c=this.outRef[n];if(c)c.render(h);else{const t=this.createElementNS("rect"),d=new a(s,o,i,t,r,e);d.render(h),this.outRef[n]=d}})}}function c(t,e,s,n){const i=t.height+2*e,o=t.width+e;return{height:"number"==typeof s?Math.max(s,i):i,width:"number"==typeof n?Math.max(n,o):o}}const l={name:"Node",ins:[],outs:[]};o(h)({computeDims:c,defaultGraph:l}),e.exports=h},{"./In":9,"./Out":18,"./SvgComponent":22,bindme:1,pdsp:2,"static-props":3}],18:[function(t,e,s){const n=t("bindme"),i=t("pdsp"),o=t("static-props"),r=t("./Pin");e.exports=class extends r{constructor(t,e,s,i,r,d){super(t,e,s,i,r,d),o(this)({y:()=>parseInt(i.getAttribute("y"))}),n(this,"onMousedown","onMouseover","onMouseup"),i.addEventListener("mousedown",this.onMousedown),i.addEventListener("mouseover",this.onMouseover),i.addEventListener("mouseup",this.onMouseup)}onMousedown(t){i(t);const{dispatch:e,frame:s,nodeId:n,position:o}=this;s.setCursorCoordinates(t),e("createHalfLink",{cursorCoordinates:s.cursorCoordinates,from:[n,o],type:this.graph.type||null})}onMouseover(t){i(t);const{dispatch:e,nodeId:s,position:n}=this;e("focusPin",{type:"out",nodeId:s,position:n})}onMouseup(t){i(t);const{dispatch:e,highlighted:s,frame:n,nodeId:o,position:r}=this;n.draggingLink&&n.draggedLink.to&&(s?e("attachHalfLink",{id:n.draggedLinkId,from:[o,r]}):e("deleteHalfLink"))}render(t){super.render(t);const{container:e,size:s}=this,{node:n}=t,i=n.height-s;this.height!==i&&e.setAttribute("y",i)}}},{"./Pin":19,bindme:1,pdsp:2,"static-props":3}],19:[function(t,e,s){const n=t("bindme"),i=t("static-props"),o=t("./SvgComponent");e.exports=class extends o{constructor(t,e,s,o,r,d){super(t,s,o),n(this,"onMouseleave"),o.addEventListener("mouseleave",this.onMouseleave),o.addEventListener("click",this.dropEvent),i(this)({frame:e,nodeId:r,position:d,theme:()=>t.theme.pin,x:()=>parseInt(o.getAttribute("x"))})}onMouseleave(){this.dispatch("blurPin")}render(t){const{container:e,theme:s}=this,{size:n}=s,{connected:i,graph:o,highlighted:r,inspected:d,node:a,position:h,selected:c}=t;this.connected=i,this.graph=o;const l=r!==this.highlighted,p=d!==this.inspected,u=c!==this.selected,g=n!==this.size;if(a.widthChanged||a.numPinsChanged)if(0===h)e.setAttribute("x",0);else{const t=h*(a.width-n)/(a.numPins-1);e.setAttribute("x",t)}g&&(this.size=n,e.setAttribute("height",n),e.setAttribute("width",n)),l&&(this.highlighted=r),p&&(this.inspected=d),u&&(this.selected=c),(l||p||u)&&(d?e.setAttribute("fill",s.inspectedColor):c?e.setAttribute("fill",s.highlightColor):r&&!i?e.setAttribute("fill",s.highlightColor):e.setAttribute("fill",s.baseColor))}}},{"./SvgComponent":22,bindme:1,"static-props":3}],20:[function(t,e,s){const n=t("bindme"),i=t("static-props"),o=t("./Component"),r=t("./Frame"),d=t("./Inspector");e.exports=class extends o{constructor(t,e,s){super(t,e,s),this.nodeName={},this.textSize={},s.style.display="flex";const o=this.createElement("div");o.style.height="auto",o.style.width="auto",o.style.position="absolute",o.style.visibility="hidden",o.style.whiteSpace="nowrap";const a=this.createElement("div"),h=new d(t,e,a),c=new r(t,e,s);i(this)({boundingRect:()=>s.getBoundingClientRect(),textRuler:o}),i(this.component)({frame:c,inspector:h}),n(this,"onWindowResize"),window.addEventListener("resize",this.onWindowResize)}onWindowResize(){this.dispatch("resize",this.boundingRect)}render(t){const{canvas:e,container:s,nodeName:n,textSize:i}=this,{graph:o}=t,{fontFamily:r,fontSize:d}=e.theme.frame;(this.fontSize!==d||this.fontFamily!==r)&&(s.style.fontFamily=r,s.style.fontSize=`${d}px`);let a=[];o.nodes.forEach(({id:t,name:e})=>{a.push(t),n[t]?e!==n[t].name&&(n[t]=e,i[t]=this.sizeOfText(e)):(n[t]=e,i[t]=this.sizeOfText(e))}),Object.keys(n).forEach(t=>{-1===a.indexOf(t)&&(delete this.nodeName[t],delete this.textSize[t])}),this.renderAllSubComponents(Object.assign({},t,{textSize:i}))}sizeOfText(t){const{textRuler:e}=this;return e.textContent=t,{height:e.clientHeight,width:e.clientWidth}}}},{"./Component":5,"./Frame":8,"./Inspector":10,bindme:1,"static-props":3}],21:[function(t,e,s){const n=t("static-props"),i=t("./SvgComponent");e.exports=class extends i{constructor(t,e,s){super(t,e,s);const i=this.createElementNS("svg"),o=this.createElementNS("path",i);o.shapeRendering="optimizeQuality",n(this)({path:o,svg:i})}render(t){const{path:e,svg:s}=this,{theme:n}=t,{color:i,size:o}=n,r=this.color!==i,d=this.size!==o;r&&(this.color=i,e.setAttribute("fill",i)),d&&(this.size=o,s.setAttribute("viewBox",`0 0 ${o} ${o}`),s.style.height=o,s.style.width=o,this.setShape(o))}setShape(){console.error("setShape method is abstract")}}},{"./SvgComponent":22,"static-props":3}],22:[function(t,e,s){const n=t("static-props"),i=t("./Component");e.exports=class extends i{constructor(t,e,s){super(t,e,s),n(this)({namespaceURI:"http://www.w3.org/2000/svg"})}createElementNS(t,e){const s=document.createElementNS(this.namespaceURI,t);return e?e.appendChild(s):this.container.appendChild(s),s}}},{"./Component":5,"static-props":3}],23:[function(t,e,s){e.exports=function(t){const e=()=>{const e=localStorage.getItem(t);return e?JSON.parse(e):e};return{assign:s=>{const n=e();n?localStorage.setItem(t,JSON.stringify(Object.assign(n,s))):localStorage.setItem(t,JSON.stringify(s))},getItem:e}}},{}],"flow-view":[function(t,e,s){const n=t("./Canvas");e.exports={Canvas:n},s.default={Canvas:n}},{"./Canvas":4}]},{},[]);