<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="data:image/x-icon;base64,AA" />
    <meta name="viewport" content="width=device-width" />

    <title>Flow View</title>
    <meta
      name="description"
      content="is a visual editor for Dataflow programming"
    />

    <link rel="stylesheet" href="./docs/style.css" />

    <script type="importmap">
      { "imports": { "flow-view": "./dist/flow-view.js" } }
    </script>
  </head>

  <body>
    <div class="layout">
      <header>
        <h1>Flow View</h1>

        <blockquote>
          is a visual editor for <em>dataflow programming</em>
        </blockquote>
      </header>

      <nav class="navigation">
        <h3>Examples</h3>
        <ul>
          <li>
            <a href="./docs/examples/basic-usage.html">Basic usage</a>
          </li>

          <li>
            <a href="./docs/examples/color-schemes.html">Color schemes</a>
          </li>
        </ul>
      </nav>

      <main class="content"></main>

      <footer>
        GitHub: <a href="https://github.com/fibo/flow-view">fibo/flow-view</a>
      </footer>
    </div>

    <script>
      const contentElement = document.querySelector("main.content");
      const contentMap = new Map();
      const anchorSelector = ".navigation a";
      const selectedClass = "selected";

      const updateNavigation = (anchor) => {
        document
          .querySelector(`${anchorSelector}.${selectedClass}`)
          ?.classList.remove(selectedClass);
        anchor.classList.add(selectedClass);
      };

      const updateContent = async (url) => {
        try {
          if (contentMap.has(url)) {
            contentElement.innerHTML = contentMap.get(url);
          } else {
            const response = await fetch(url);
            const content = await response.text();
            contentMap.set(url, content);
            contentElement.innerHTML = content;
          }
        } catch (error) {
          console.error(error);
        }
      };

      const updateDOM = (anchor) => {
        updateNavigation(anchor);
        updateContent(anchor.href);
      };

      addEventListener("load", () => {
        for (const anchor of document.querySelectorAll(anchorSelector))
          anchor.addEventListener("click", (event) => {
            event.preventDefault();
            if (event.target.classList.contains(selectedClass)) return;
            if (!document.startViewTransition) return updateDOM(anchor);
            document.startViewTransition(() => {
              updateDOM(anchor);
            });
          });

        document.querySelector(anchorSelector).click();
      });
    </script>
  </body>
</html>
